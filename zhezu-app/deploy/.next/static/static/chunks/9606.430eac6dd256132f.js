"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9606],{9185:(e,t,s)=>{s.r(t),s.d(t,{default:()=>o});var i=s(401),l=s(4917),a=s(3893),n=s(6427),r=s(8178),c=s(892);function o({open:e,onClose:t,onInsert:s}){let[o,d]=(0,l.useState)(""),[u,x]=(0,l.useState)(null),[h,g]=(0,l.useState)(!1),[b,j]=(0,l.useState)(""),[k,f]=(0,l.useState)(!1),v=(0,l.useRef)(null),m=()=>{d(""),x(null),g(!1),j(""),f(!1),t()},p=(0,l.useCallback)(async e=>{if(!["image/jpeg","image/png","image/webp"].includes(e.type))return void j("Допустимые форматы: JPEG, PNG, WebP");if(e.size>5242880)return void j("Максимальный размер — 5 МБ");j(""),g(!0);let t=URL.createObjectURL(e);x(t);let s=new FormData;s.append("file",e);try{let e=await fetch("/api/admin/upload",{method:"POST",body:s});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||"Ошибка загрузки")}let{url:t}=await e.json();d(t),x(t)}catch(e){j(e instanceof Error?e.message:"Ошибка загрузки"),x(null)}finally{g(!1),URL.revokeObjectURL(t)}},[]),A=(0,l.useCallback)(e=>{e.preventDefault(),f(!1);let t=e.dataTransfer.files[0];t&&p(t)},[p]);return e?(0,i.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:m,children:(0,i.jsxs)("div",{className:"mx-4 w-full max-w-md rounded-xl bg-white p-6 shadow-2xl dark:bg-slate-800",onClick:e=>e.stopPropagation(),children:[(0,i.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:"Вставить изображение"}),(0,i.jsx)("button",{type:"button",onClick:m,className:"rounded-lg p-1 text-slate-400 hover:bg-slate-100 hover:text-slate-600 dark:hover:bg-slate-700 dark:hover:text-white",children:(0,i.jsx)(a.A,{size:20})})]}),(0,i.jsx)("div",{onDragOver:e=>{e.preventDefault(),f(!0)},onDragLeave:()=>f(!1),onDrop:A,onClick:()=>v.current?.click(),className:`mb-4 flex cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed p-8 transition-colors ${k?"border-blue-400 bg-blue-50 dark:border-blue-500 dark:bg-blue-500/10":"border-slate-300 bg-slate-50 hover:border-slate-400 dark:border-slate-600 dark:bg-slate-700/50 dark:hover:border-slate-500"}`,children:h?(0,i.jsx)(n.A,{size:32,className:"animate-spin text-blue-500"}):u?(0,i.jsx)("img",{src:u,alt:"Preview",className:"max-h-40 max-w-full rounded-lg object-contain"}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.A,{size:32,className:"mb-2 text-slate-400"}),(0,i.jsx)("p",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:"Перетащите файл сюда"}),(0,i.jsx)("p",{className:"mt-1 text-xs text-slate-400",children:"или нажмите для выбора"}),(0,i.jsx)("p",{className:"mt-2 text-xs text-slate-400",children:"JPEG, PNG, WebP — до 5 МБ"})]})}),(0,i.jsx)("input",{ref:v,type:"file",accept:"image/jpeg,image/png,image/webp",className:"hidden",onChange:e=>{let t=e.target.files?.[0];t&&p(t)}}),(0,i.jsxs)("div",{className:"mb-4 flex items-center gap-3",children:[(0,i.jsx)("div",{className:"h-px flex-1 bg-slate-200 dark:bg-slate-700"}),(0,i.jsx)("span",{className:"text-xs text-slate-400",children:"или"}),(0,i.jsx)("div",{className:"h-px flex-1 bg-slate-200 dark:bg-slate-700"})]}),(0,i.jsx)("input",{type:"url",value:o,onChange:e=>{d(e.target.value),x(e.target.value||null),j("")},placeholder:"https://example.com/image.jpg",className:"mb-4 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 placeholder-slate-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none dark:border-slate-600 dark:bg-slate-700 dark:text-white dark:placeholder-slate-500"}),b&&(0,i.jsx)("p",{className:"mb-3 text-sm text-red-500",children:b}),(0,i.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,i.jsx)("button",{type:"button",onClick:m,className:"rounded-lg px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-700",children:"Отмена"}),(0,i.jsxs)("button",{type:"button",onClick:()=>{let e=o.trim();e&&(s(e),m())},disabled:!o.trim()||h,className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-50",children:[(0,i.jsx)(c.A,{size:14,className:"-mt-0.5 mr-1.5 inline-block"}),"Вставить"]})]})]})}):null}},9606:(e,t,s)=>{s.r(t),s.d(t,{default:()=>B});var i=s(401),l=s(719),a=s(9859),n=s(3733),r=s(7103),c=s(7877),o=s(6271),d=s(2049),u=s(7613),x=s(4917),h=s(9185),g=s(8738),b=s(5164),j=s(1312),k=s(3343),f=s(6701),v=s(9194),m=s(5185),p=s(2184),A=s(1771),C=s(7707),z=s(1679),N=s(3573),w=s(7186),y=s(4500),L=s(6853),P=s(4341),T=s(6333),U=s(4627),H=s(2004),R=s(892),S=s(6561);function E({onClick:e,active:t,disabled:s,title:l,children:a}){return(0,i.jsx)("button",{type:"button",onClick:e,disabled:s,title:l,className:`rounded p-1.5 transition-colors disabled:opacity-30 ${t?"bg-blue-100 text-blue-700 dark:bg-blue-500/20 dark:text-blue-400":"text-slate-500 hover:bg-slate-100 hover:text-slate-700 dark:text-slate-400 dark:hover:bg-slate-700 dark:hover:text-white"}`,children:a})}function M(){return(0,i.jsx)("div",{className:"mx-1 h-6 w-px bg-slate-200 dark:bg-slate-700"})}function B({value:e,onChange:t,placeholder:s}){let B=(0,l.hG)({extensions:[n.A.configure({heading:{levels:[1,2,3]}}),r.A,c.A.configure({types:["heading","paragraph"]}),o.Ay.configure({openOnClick:!1,HTMLAttributes:{class:"text-blue-600 underline"}}),d.Ay.configure({HTMLAttributes:{class:"rounded-lg max-w-full mx-auto"}}),u.A.configure({placeholder:s||"Начните писать..."})],content:e||"",onUpdate:({editor:e})=>{t(e.getHTML())},editorProps:{attributes:{class:"px-4 py-3 min-h-[300px] text-sm text-slate-900 dark:text-slate-100 focus:outline-none"}}});(0,x.useEffect)(()=>{B&&e!==B.getHTML()&&B.commands.setContent(e||"",{emitUpdate:!1})},[e,B]);let D=(0,x.useCallback)(()=>{if(!B)return;let e=prompt("Введите URL ссылки:",B.getAttributes("link").href||"");null!==e&&(""===e?B.chain().focus().extendMarkRange("link").unsetLink().run():B.chain().focus().extendMarkRange("link").setLink({href:e}).run())},[B]),[O,G]=(0,x.useState)(!1),I=(0,x.useCallback)(e=>{B&&B.chain().focus().setImage({src:e}).run()},[B]);return B?(0,i.jsxs)("div",{className:"overflow-hidden rounded-lg border border-slate-200 bg-white dark:border-slate-700 dark:bg-slate-800",children:[(0,i.jsxs)("div",{className:"flex flex-wrap items-center gap-0.5 border-b border-slate-200 bg-slate-50 px-2 py-1.5 dark:border-slate-700 dark:bg-slate-900",children:[(0,i.jsx)(E,{onClick:()=>B.chain().focus().undo().run(),disabled:!B.can().undo(),title:"Отменить",children:(0,i.jsx)(g.A,{size:15})}),(0,i.jsx)(E,{onClick:()=>B.chain().focus().redo().run(),disabled:!B.can().redo(),title:"Повторить",children:(0,i.jsx)(b.A,{size:15})}),(0,i.jsx)(M,{}),(0,i.jsx)(E,{onClick:()=>B.chain().focus().toggleBold().run(),active:B.isActive("bold"),title:"Жирный (Ctrl+B)",children:(0,i.jsx)(j.A,{size:15})}),(0,i.jsx)(E,{onClick:()=>B.chain().focus().toggleItalic().run(),active:B.isActive("italic"),title:"Курсив (Ctrl+I)",children:(0,i.jsx)(k.A,{size:15})}),(0,i.jsx)(E,{onClick:()=>B.chain().focus().toggleUnderline().run(),active:B.isActive("underline"),title:"Подчёркнутый (Ctrl+U)",children:(0,i.jsx)(f.A,{size:15})}),(0,i.jsx)(E,{onClick:()=>B.chain().focus().toggleStrike().run(),active:B.isActive("strike"),title:"Зачёркнутый",children:(0,i.jsx)(v.A,{size:15})}),(0,i.jsx)(M,{}),(0,i.jsx)(E,{onClick:()=>B.chain().focus().toggleHeading({level:1}).run(),active:B.isActive("heading",{level:1}),title:"Заголовок 1",children:(0,i.jsx)(m.A,{size:15})}),(0,i.jsx)(E,{onClick:()=>B.chain().focus().toggleHeading({level:2}).run(),active:B.isActive("heading",{level:2}),title:"Заголовок 2",children:(0,i.jsx)(p.A,{size:15})}),(0,i.jsx)(E,{onClick:()=>B.chain().focus().toggleHeading({level:3}).run(),active:B.isActive("heading",{level:3}),title:"Заголовок 3",children:(0,i.jsx)(A.A,{size:15})}),(0,i.jsx)(M,{}),(0,i.jsx)(E,{onClick:()=>B.chain().focus().toggleBulletList().run(),active:B.isActive("bulletList"),title:"Маркированный список",children:(0,i.jsx)(C.A,{size:15})}),(0,i.jsx)(E,{onClick:()=>B.chain().focus().toggleOrderedList().run(),active:B.isActive("orderedList"),title:"Нумерованный список",children:(0,i.jsx)(z.A,{size:15})}),(0,i.jsx)(M,{}),(0,i.jsx)(E,{onClick:()=>B.chain().focus().setTextAlign("left").run(),active:B.isActive({textAlign:"left"}),title:"По левому краю",children:(0,i.jsx)(N.A,{size:15})}),(0,i.jsx)(E,{onClick:()=>B.chain().focus().setTextAlign("center").run(),active:B.isActive({textAlign:"center"}),title:"По центру",children:(0,i.jsx)(w.A,{size:15})}),(0,i.jsx)(E,{onClick:()=>B.chain().focus().setTextAlign("right").run(),active:B.isActive({textAlign:"right"}),title:"По правому краю",children:(0,i.jsx)(y.A,{size:15})}),(0,i.jsx)(E,{onClick:()=>B.chain().focus().setTextAlign("justify").run(),active:B.isActive({textAlign:"justify"}),title:"По ширине",children:(0,i.jsx)(L.A,{size:15})}),(0,i.jsx)(M,{}),(0,i.jsx)(E,{onClick:()=>B.chain().focus().toggleBlockquote().run(),active:B.isActive("blockquote"),title:"Цитата",children:(0,i.jsx)(P.A,{size:15})}),(0,i.jsx)(E,{onClick:()=>B.chain().focus().setHorizontalRule().run(),title:"Горизонтальная линия",children:(0,i.jsx)(T.A,{size:15})}),(0,i.jsx)(M,{}),(0,i.jsx)(E,{onClick:D,active:B.isActive("link"),title:"Ссылка",children:(0,i.jsx)(U.A,{size:15})}),B.isActive("link")&&(0,i.jsx)(E,{onClick:()=>B.chain().focus().unsetLink().run(),title:"Убрать ссылку",children:(0,i.jsx)(H.A,{size:15})}),(0,i.jsx)(E,{onClick:()=>G(!0),title:"Вставить изображение",children:(0,i.jsx)(R.A,{size:15})}),(0,i.jsx)(M,{}),(0,i.jsx)(E,{onClick:()=>B.chain().focus().clearNodes().unsetAllMarks().run(),title:"Очистить форматирование",children:(0,i.jsx)(S.A,{size:15})})]}),(0,i.jsxs)(a.m,{editor:B,className:"flex items-center gap-0.5 rounded-lg border border-slate-200 bg-white px-1.5 py-1 shadow-lg dark:border-slate-600 dark:bg-slate-800",children:[(0,i.jsx)(E,{onClick:()=>B.chain().focus().toggleBold().run(),active:B.isActive("bold"),title:"Жирный",children:(0,i.jsx)(j.A,{size:14})}),(0,i.jsx)(E,{onClick:()=>B.chain().focus().toggleItalic().run(),active:B.isActive("italic"),title:"Курсив",children:(0,i.jsx)(k.A,{size:14})}),(0,i.jsx)(E,{onClick:()=>B.chain().focus().toggleUnderline().run(),active:B.isActive("underline"),title:"Подчёркнутый",children:(0,i.jsx)(f.A,{size:14})}),(0,i.jsx)(E,{onClick:()=>B.chain().focus().toggleStrike().run(),active:B.isActive("strike"),title:"Зачёркнутый",children:(0,i.jsx)(v.A,{size:14})}),(0,i.jsx)("div",{className:"mx-0.5 h-5 w-px bg-slate-200 dark:bg-slate-600"}),(0,i.jsx)(E,{onClick:()=>B.chain().focus().toggleHeading({level:2}).run(),active:B.isActive("heading",{level:2}),title:"Заголовок",children:(0,i.jsx)(p.A,{size:14})}),(0,i.jsx)(E,{onClick:()=>B.chain().focus().toggleBlockquote().run(),active:B.isActive("blockquote"),title:"Цитата",children:(0,i.jsx)(P.A,{size:14})}),(0,i.jsx)("div",{className:"mx-0.5 h-5 w-px bg-slate-200 dark:bg-slate-600"}),(0,i.jsx)(E,{onClick:D,active:B.isActive("link"),title:"Ссылка",children:(0,i.jsx)(U.A,{size:14})}),B.isActive("link")&&(0,i.jsx)(E,{onClick:()=>B.chain().focus().unsetLink().run(),title:"Убрать ссылку",children:(0,i.jsx)(H.A,{size:14})})]}),(0,i.jsx)(l.$Z,{editor:B}),(0,i.jsx)(h.default,{open:O,onClose:()=>G(!1),onInsert:I})]}):null}}}]);