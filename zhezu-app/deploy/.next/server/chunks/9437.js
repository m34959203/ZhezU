"use strict";exports.id=9437,exports.ids=[9437],exports.modules={19437:(a,b,c)=>{c.r(b),c.d(b,{default:()=>j});var d=c(42967),e=c(82338),f=c(17831),g=c(69297),h=c(8650),i=c(73302);function j({open:a,onClose:b,onInsert:c}){let[j,k]=(0,e.useState)(""),[l,m]=(0,e.useState)(null),[n,o]=(0,e.useState)(!1),[p,q]=(0,e.useState)(""),[r,s]=(0,e.useState)(!1),t=(0,e.useRef)(null),u=()=>{k(""),m(null),o(!1),q(""),s(!1),b()},v=(0,e.useCallback)(async a=>{if(!["image/jpeg","image/png","image/webp"].includes(a.type))return void q("Допустимые форматы: JPEG, PNG, WebP");if(a.size>5242880)return void q("Максимальный размер — 5 МБ");q(""),o(!0);let b=URL.createObjectURL(a);m(b);let c=new FormData;c.append("file",a);try{let a=await fetch("/api/admin/upload",{method:"POST",body:c});if(!a.ok){let b=await a.json().catch(()=>({}));throw Error(b.error||"Ошибка загрузки")}let{url:b}=await a.json();k(b),m(b)}catch(a){q(a instanceof Error?a.message:"Ошибка загрузки"),m(null)}finally{o(!1),URL.revokeObjectURL(b)}},[]),w=(0,e.useCallback)(a=>{a.preventDefault(),s(!1);let b=a.dataTransfer.files[0];b&&v(b)},[v]);return a?(0,d.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:u,children:(0,d.jsxs)("div",{className:"mx-4 w-full max-w-md rounded-xl bg-white p-6 shadow-2xl dark:bg-slate-800",onClick:a=>a.stopPropagation(),children:[(0,d.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:"Вставить изображение"}),(0,d.jsx)("button",{type:"button",onClick:u,className:"rounded-lg p-1 text-slate-400 hover:bg-slate-100 hover:text-slate-600 dark:hover:bg-slate-700 dark:hover:text-white",children:(0,d.jsx)(f.A,{size:20})})]}),(0,d.jsx)("div",{onDragOver:a=>{a.preventDefault(),s(!0)},onDragLeave:()=>s(!1),onDrop:w,onClick:()=>t.current?.click(),className:`mb-4 flex cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed p-8 transition-colors ${r?"border-blue-400 bg-blue-50 dark:border-blue-500 dark:bg-blue-500/10":"border-slate-300 bg-slate-50 hover:border-slate-400 dark:border-slate-600 dark:bg-slate-700/50 dark:hover:border-slate-500"}`,children:n?(0,d.jsx)(g.A,{size:32,className:"animate-spin text-blue-500"}):l?(0,d.jsx)("img",{src:l,alt:"Preview",className:"max-h-40 max-w-full rounded-lg object-contain"}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(h.A,{size:32,className:"mb-2 text-slate-400"}),(0,d.jsx)("p",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:"Перетащите файл сюда"}),(0,d.jsx)("p",{className:"mt-1 text-xs text-slate-400",children:"или нажмите для выбора"}),(0,d.jsx)("p",{className:"mt-2 text-xs text-slate-400",children:"JPEG, PNG, WebP — до 5 МБ"})]})}),(0,d.jsx)("input",{ref:t,type:"file",accept:"image/jpeg,image/png,image/webp",className:"hidden",onChange:a=>{let b=a.target.files?.[0];b&&v(b)}}),(0,d.jsxs)("div",{className:"mb-4 flex items-center gap-3",children:[(0,d.jsx)("div",{className:"h-px flex-1 bg-slate-200 dark:bg-slate-700"}),(0,d.jsx)("span",{className:"text-xs text-slate-400",children:"или"}),(0,d.jsx)("div",{className:"h-px flex-1 bg-slate-200 dark:bg-slate-700"})]}),(0,d.jsx)("input",{type:"url",value:j,onChange:a=>{k(a.target.value),m(a.target.value||null),q("")},placeholder:"https://example.com/image.jpg",className:"mb-4 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 placeholder-slate-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none dark:border-slate-600 dark:bg-slate-700 dark:text-white dark:placeholder-slate-500"}),p&&(0,d.jsx)("p",{className:"mb-3 text-sm text-red-500",children:p}),(0,d.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,d.jsx)("button",{type:"button",onClick:u,className:"rounded-lg px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-700",children:"Отмена"}),(0,d.jsxs)("button",{type:"button",onClick:()=>{let a=j.trim();a&&(c(a),u())},disabled:!j.trim()||n,className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-50",children:[(0,d.jsx)(i.A,{size:14,className:"-mt-0.5 mr-1.5 inline-block"}),"Вставить"]})]})]})}):null}}};