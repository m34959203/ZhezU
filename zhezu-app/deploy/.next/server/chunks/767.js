exports.id=767,exports.ids=[767],exports.modules={23289:()=>{},36441:()=>{},39013:(a,b,c)=>{"use strict";c.r(b),c.d(b,{news:()=>j,settings:()=>k});var d=c(61352),e=c(78869),f=c(45384),g=c(37977),h=c(89460),i=c(30029);let j=(0,d.Nn)("news",{id:(0,e.yf)("id",{length:36}).primaryKey(),slug:(0,e.yf)("slug",{length:255}).notNull().default(""),title:(0,f.Pq)("title").notNull().$type(),excerpt:(0,f.Pq)("excerpt").notNull().$type(),body:(0,f.Pq)("body").notNull().$type(),category:(0,e.yf)("category",{length:50}).notNull().default("news"),image:(0,g.Qq)("image"),published:(0,h.zM)("published").notNull().default(!1),pinned:(0,h.zM)("pinned").notNull().default(!1),author:(0,e.yf)("author",{length:255}).notNull().default(""),socialPublished:(0,f.Pq)("social_published").$type(),createdAt:(0,i.vE)("created_at").notNull().defaultNow(),updatedAt:(0,i.vE)("updated_at").notNull().defaultNow().onUpdateNow()}),k=(0,d.Nn)("settings",{key:(0,e.yf)("key",{length:100}).primaryKey(),value:(0,f.Pq)("value").notNull(),updatedAt:(0,i.vE)("updated_at").notNull().defaultNow().onUpdateNow()})},45724:(a,b,c)=>{"use strict";c.d(b,{DZ:()=>s,TF:()=>p,UK:()=>l,getById:()=>m,kh:()=>v,mt:()=>r,n3:()=>u,vt:()=>n,yo:()=>o});var d=c(79748),e=c(33873),f=c.n(e),g=c(28012),h=c(95862),i=c(74560),j=c(39013);let k="news.json";async function l(a){return a===k?(await i.db.select().from(j.news).orderBy((0,g.i)(j.news.createdAt))).map(x):await r(a,[])}async function m(a,b){if(a===k){let[a]=await i.db.select().from(j.news).where((0,h.eq)(j.news.id,b)).limit(1);return a?x(a):null}return(await l(a)).find(a=>a.id===b)??null}async function n(a,b){if(a===k)return await i.db.insert(j.news).values({id:b.id,slug:b.slug||"",title:b.title,excerpt:b.excerpt,body:b.body,category:b.category||"news",image:b.image||"",published:b.published??!1,pinned:b.pinned??!1,author:b.author||"",socialPublished:b.socialPublished}),b;let c=await l(a);return c.unshift(b),await s(a,c),b}async function o(a,b,c){if(a===k){let a={};void 0!==c.slug&&(a.slug=c.slug),void 0!==c.title&&(a.title=c.title),void 0!==c.excerpt&&(a.excerpt=c.excerpt),void 0!==c.body&&(a.body=c.body),void 0!==c.category&&(a.category=c.category),void 0!==c.image&&(a.image=c.image),void 0!==c.published&&(a.published=c.published),void 0!==c.pinned&&(a.pinned=c.pinned),void 0!==c.author&&(a.author=c.author),void 0!==c.socialPublished&&(a.socialPublished=c.socialPublished),await i.db.update(j.news).set(a).where((0,h.eq)(j.news.id,b));let[d]=await i.db.select().from(j.news).where((0,h.eq)(j.news.id,b)).limit(1);return d?x(d):null}let d=await l(a),e=d.findIndex(a=>a.id===b);return -1===e?null:(d[e]={...d[e],...c},await s(a,d),d[e])}async function p(a,b){if(a===k){let a=await i.db.delete(j.news).where((0,h.eq)(j.news.id,b));return(a[0]?.affectedRows??0)>0}let c=await l(a),d=c.filter(a=>a.id!==b);return d.length!==c.length&&(await s(a,d),!0)}function q(a){return a.replace(/\.json$/,"")}async function r(a,b){let c=q(a),[d]=await i.db.select().from(j.settings).where((0,h.eq)(j.settings.key,c)).limit(1);if(!d)return b;let e=d.value;if("string"==typeof e)try{return JSON.parse(e)}catch{return b}return e}async function s(a,b){let c=q(a);await i.db.insert(j.settings).values({key:c,value:b}).onDuplicateKeyUpdate({set:{value:b}})}let t=f().join(process.cwd(),"src","i18n","messages");async function u(a){let b=f().join(t,`${a}.json`);return JSON.parse(await (0,d.readFile)(b,"utf-8"))}async function v(a,b){let c=f().join(t,`${a}.json`);await (0,d.writeFile)(c,JSON.stringify(b,null,2)+"\n","utf-8")}function w(a){if("string"==typeof a)try{return JSON.parse(a)}catch{}return a}function x(a){return{id:a.id,slug:a.slug,title:w(a.title),excerpt:w(a.excerpt),body:w(a.body),category:a.category,image:a.image||"",published:a.published,pinned:a.pinned,author:a.author,socialPublished:w(a.socialPublished)??void 0,createdAt:a.createdAt.toISOString(),updatedAt:a.updatedAt.toISOString()}}},58622:(a,b,c)=>{"use strict";c.d(b,{XW:()=>h,_9:()=>g,a5:()=>j});var d=c(45724);let e={siteName:"",contactEmail:"",contactPhone:"",address:{kk:"",ru:"",en:""},socialLinks:{},admissionOpen:!1,maintenanceMode:!1};async function f(){let a=await (0,d.mt)("settings.json",e),b=a.integrations?.geminiApiKey||process.env.GEMINI_API_KEY;if(!b)throw Error("Gemini API ключ не настроен. Укажите его в Настройки → Интеграции.");return{apiKey:b,model:a.integrations?.geminiModel||"gemini-2.5-flash"}}async function g(){let a=await (0,d.mt)("settings.json",e),b=a.integrations?.telegramBotToken||process.env.TELEGRAM_BOT_TOKEN||"",c=a.integrations?.telegramChatId||process.env.TELEGRAM_CHAT_ID||"";return b&&c?{botToken:b,chatId:c}:null}async function h(){let a=await (0,d.mt)("settings.json",e),b=a.integrations?.instagramAccessToken||"",c=a.integrations?.instagramPageId||"";return b&&c?{accessToken:b,pageId:c}:null}async function i(a){return new Promise(b=>setTimeout(b,a))}async function j(a,b){let c=await f(),d=`https://generativelanguage.googleapis.com/v1beta/models/${c.model}:generateContent?key=${c.apiKey}`,e={contents:[{parts:[{text:a}]}],generationConfig:{temperature:b?.temperature??.3,maxOutputTokens:b?.maxTokens??8192}},g=null,h=[2e3,4e3,8e3];for(let a=0;a<=h.length;a++)try{let b=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if((429===b.status||b.status>=500)&&a<h.length){await i(h[a]);continue}let c=await b.json();if(c.error)throw Error(`Gemini API error: ${c.error.message}`);let f=c.candidates?.[0]?.content?.parts?.[0]?.text;if(!f)throw Error("Empty response from Gemini");return f.trim()}catch(b){g=b instanceof Error?b:Error(String(b)),a<h.length&&await i(h[a])}throw g??Error("Gemini API call failed")}},72359:(a,b,c)=>{"use strict";c.d(b,{BE:()=>l,Ey:()=>i,Ht:()=>k,nr:()=>j,z4:()=>f});var d=c(55511),e=c(34003);let f="admin_token";function g(){let a=process.env.ADMIN_SECRET;if(!a||a.length<8)throw Error("ADMIN_SECRET env variable must be set (min 8 chars)");return a}function h(a){return(0,d.createHmac)("sha256",g()).update(a).digest("hex")}function i(){let a={role:"admin",exp:Date.now()+288e5},b=Buffer.from(JSON.stringify(a)).toString("base64url"),c=h(b);return`${b}.${c}`}function j(a){try{let[b,c]=a.split(".");if(!b||!c||h(b)!==c)return null;let d=JSON.parse(Buffer.from(b,"base64url").toString("utf-8"));if(d.exp<Date.now()||"admin"!==d.role)return null;return d}catch{return null}}async function k(){let a=await (0,e.UL)(),b=a.get(f)?.value;return b?j(b):null}function l(a){return a===g()}},74560:(a,b,c)=>{"use strict";c.d(b,{db:()=>h});var d=c(55256),e=c(23844),f=c(39013);let g=null,h=(0,d.fd)((g||(g=e.createPool({uri:function(){let a=process.env.DATABASE_URL;if(a)return a;let b=process.env.DB_HOST||"localhost",c=process.env.DB_PORT||"3306",d=process.env.DB_USER||"root",e=process.env.DB_PASSWORD||"",f=process.env.DB_NAME||"zhezu";return`mysql://${d}:${e}@${b}:${c}/${f}`}(),waitForConnections:!0,connectionLimit:5,maxIdle:2,idleTimeout:6e4})),g),{schema:f,mode:"default"})},83992:(a,b,c)=>{"use strict";c.d(b,{r:()=>m});var d=c(58622),e=c(45724);let f="news.json",g={siteName:"",contactEmail:"",contactPhone:"",address:{kk:"",ru:"",en:""},socialLinks:{},admissionOpen:!1,maintenanceMode:!1};function h(a){return a.replace(/<[^>]*>/g,"").trim()}let i={news:"#жаналыктар #новости",announcement:"#хабарлама #объявление",event:"#іс_шара #событие",achievement:"#жетістік #достижение",university:"#университет",science:"#гылым #наука",students:"#студенттер #студенты",sport:"#спорт",culture:"#мәдениет #культура"};async function j(a){return new Promise(b=>setTimeout(b,a))}async function k(a){let b,c,e,f,g,j=await (0,d._9)();if(!j)return{ok:!1,error:"Telegram не настроен"};let k=(e=a.title.ru||a.title.kk,f=h(a.excerpt.ru||a.excerpt.kk),g=i[a.category]||"#ZhezU",`<b>${e}</b>

${f}

${g} #ZhezU`);a.image?(b=`https://api.telegram.org/bot${j.botToken}/sendPhoto`,c={chat_id:j.chatId,photo:a.image,caption:k,parse_mode:"HTML"}):(b=`https://api.telegram.org/bot${j.botToken}/sendMessage`,c={chat_id:j.chatId,text:k,parse_mode:"HTML"});try{let a=await fetch(b,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),d=await a.json();if(!d.ok)return{ok:!1,error:d.description||"Telegram API error"};return{ok:!0}}catch(a){return{ok:!1,error:a instanceof Error?a.message:"Network error"}}}async function l(a){let b,c,e,f=await (0,d.XW)();if(!f)return{ok:!1,error:"Instagram не настроен"};if(!a.image)return{ok:!1,error:"Для Instagram необходимо изображение"};let g=(b=a.title.ru||a.title.kk,c=h(a.excerpt.ru||a.excerpt.kk),e=i[a.category]||"",`${b}

${c}

${e} #ZhezU #Жезказган #Zhezkazgan #университет`.trim());try{let b=await fetch(`https://graph.facebook.com/v21.0/${f.pageId}/media`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image_url:a.image,caption:g,access_token:f.accessToken})}),c=await b.json();if(c.error)return{ok:!1,error:c.error.message};let d=c.id;for(let a=0;a<20;a++){await j(3e3);let a=await fetch(`https://graph.facebook.com/v21.0/${d}?fields=status_code&access_token=${f.accessToken}`),b=await a.json();if("FINISHED"===b.status_code)break;if("ERROR"===b.status_code)return{ok:!1,error:"Ошибка обработки медиа"}}let e=await fetch(`https://graph.facebook.com/v21.0/${f.pageId}/media_publish`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({creation_id:d,access_token:f.accessToken})}),h=await e.json();if(h.error)return{ok:!1,error:h.error.message};return{ok:!0}}catch(a){return{ok:!1,error:a instanceof Error?a.message:"Network error"}}}async function m(a){let b=await (0,e.mt)("settings.json",g);if(!b.integrations?.autoPublishSocial)return{};let d={},h={},{getById:i}=await Promise.resolve().then(c.bind(c,45724)),j=await i(f,a);if(!j)return{};if(b.integrations?.telegramEnabled){let a=await k(j);d.telegram=a,a.ok&&(h.telegram=!0)}if(b.integrations?.instagramEnabled&&j.image){let a=await l(j);d.instagram=a,a.ok&&(h.instagram=!0)}return Object.keys(h).length>0&&await (0,e.yo)(f,a,{socialPublished:{...j.socialPublished,...h}}),d}},86140:a=>{function b(a){var b=Error("Cannot find module '"+a+"'");throw b.code="MODULE_NOT_FOUND",b}b.keys=()=>[],b.resolve=b,b.id=86140,a.exports=b}};