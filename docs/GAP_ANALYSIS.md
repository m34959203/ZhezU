# GAP-анализ: ZhezU — Текущее состояние vs Техническое задание v1.0

**Дата:** 27.02.2026
**Версия:** 3.0
**Автор:** Технический аудит (обновлено)
**Проект:** Веб-сайт Жезказганского университета имени О.А. Байконурова

---

## 1. Резюме (Executive Summary)

### Общая готовность: ~55-60%

Проект ZhezU значительно продвинулся и находится в стадии **функционального фронтенда с расширенной JSON-based CMS, AI-интеграциями и CI/CD**. Реализовано 93 страницы (82 публичных + 11 admin), 30 компонентов, 25 API-эндпоинтов, полная i18n на 3 языках (22 namespace-а, ~3 350+ ключей), админ-панель с авторизацией, CRUD, AI-авто-переводом, авто-публикацией в соцсети. CI/CD настроен через GitHub Actions.

### Ключевые выводы

1. **Фронтенд полностью реализован.** 82 публичных страницы покрывают все разделы навигации (Университет 16, Поступление 14, Образование 13, Наука 11, AI-Центр 9, Жизнь 12, Карьера, Контакты, Пул талантов, Карта навыков, Конфиденциальность, Карта сайта). Мега-меню с 6 пунктами реализовано.

2. **Расширенная JSON-based CMS реализована.** Админ-панель с 11 страницами и 25 API-эндпоинтами. CRUD для новостей (9 категорий), редактор настроек, переводов, меню, главной страницы, университета, контактов. Данные хранятся в 6 JSON-файлах (news, settings, menu, homepage, university, contact). AI-функции: авто-перевод, анализ контента, валидация через Google Gemini. Авто-публикация в Telegram и Instagram. Загрузка фото.

3. **Тестирование начато.** 7 unit-тестов (6 компонентов + 1 утилита) с Vitest 4.0. Playwright настроен для E2E. CI запускает тесты на каждый push/PR. ТЗ требует >= 80% unit-покрытия — текущее покрытие минимально.

4. **Минимальная внешняя интеграция.** Реализована интеграция с Google Gemini AI, Telegram Bot API, Instagram Graph API. ТЗ требует ещё 7+ интеграций (CRM, LMS, Google Calendar, платежные системы, SSO, Scopus, библиотека).

5. **CI/CD реализован.** GitHub Actions: lint (ESLint + Prettier) → typecheck (tsc) → test (Vitest) → build (Next.js). ТЗ также требует deployment pipeline, мониторинг — пока отсутствуют.

6. **Безопасность реализована частично.** HMAC-SHA256 + httpOnly cookies, non-root Docker, file validation при загрузке. Нет CSP-заголовков, rate limiting, WAF, пользовательской аутентификации.

7. **i18n и SEO на высоком уровне.** 22 namespace-а переводов на 3 языках (~3 350+ ключей). hreflang, мета-теги, OG-теги, robots.txt, sitemap.xml реализованы. Нет Schema.org JSON-LD разметки.

### Объём недостающей работы

| Категория | Готовность | Комментарий |
|-----------|-----------|-------------|
| Фронтенд (MVP-страницы) | **~90%** | 82 публичных страницы, все разделы покрыты |
| CMS / управление контентом | **~50%** | JSON-based CMS с 11-страничной админ-панелью, 25 API, AI-перевод, авто-публикация; нужна миграция на Headless CMS |
| База данных | 0% | Нет PostgreSQL, нет схемы |
| API-слой | **~45%** | 25 эндпоинтов (17 admin + 6 public + 2 general), нужны ещё ~10 |
| Интеграции | **~15%** | 3 из 10+: Google Gemini AI, Telegram Bot, Instagram Graph API |
| Тестирование | **~10%** | 7 unit-тестов, Vitest + Playwright настроены, CI запускает тесты |
| CI/CD | **~40%** | GitHub Actions (lint, typecheck, test, build); нет deploy, staging, мониторинга |
| Безопасность | **~20%** | HMAC-SHA256, httpOnly cookies, non-root Docker, file validation |
| i18n / SEO | **~80%** | Полная i18n (3 350+ ключей), hreflang, мета-теги, robots.txt, sitemap.xml; нет Schema.org |
| Инфраструктура | **~15%** | Dockerfile + railway.toml + CI/CD |
| Мониторинг | 0% | Нет Sentry, нет Grafana |
| Компоненты | **~55%** | 30 из ~55 необходимых |

---

## 2. Матрица разрывов (Gap Matrix)

### 2.1 Функциональные требования — MVP (Фаза 1)

| ID | Требование | Статус | Описание разрыва | Приоритет | Трудоемкость |
|----|-----------|--------|-------------------|-----------|-------------|
| FR-001 | Hero-блок с видео/слайдером, управляемый через CMS | **Частично** | Hero-секция существует на главной. Нет видео, нет слайдера, нет CMS-управления баннером. | Средний | M |
| FR-002 | Ролевые быстрые ссылки (Абитуриент, Студент, Сотрудник, Выпускник) | **Частично** | Мега-меню содержит разделы для всех аудиторий. Нет отдельного блока быстрых ссылок на главной. | Низкий | S |
| FR-003 | Анимированные счетчики (студенты, программы, рейтинги) | **Частично** | Блок статистики существует. Счетчики не анимированы. Данные из `constants.ts`. | Низкий | S |
| FR-004 | Блок новостей (3-4 последних из CMS API) | **Готово** | ✅ Новостная лента на главной, получает данные из `/api/public/news`. 16 seed-новостей, 9 категорий. CRUD через админ-панель. | — | — |
| FR-005 | Блок событий (интеграция с Google Calendar) | **Частично** | Страница `/life/events` и `/life/events/calendar` существуют. Нет интеграции с Google Calendar API. | Средний | M |
| FR-010 | Каталог программ с lazy loading | **Частично** | Страница `/academics` существует. 22 программы по кафедрам. Детальные страницы `/academics/[slug]`. Нет lazy loading. | Средний | S |
| FR-011 | Фасетная фильтрация (уровень, направление, язык, формат, стоимость) — AJAX | **Частично** | Есть текстовый поиск по программам. Нет полноценной фасетной фильтрации. | Средний | M |
| FR-012 | Сортировка (имя, популярность, дата) с сохранением в URL | **Отсутствует** | Нет сортировки. Нет URL-персистентности параметров. | Средний | S |
| FR-013 | Детальная страница программы (аккордеон учебного плана, Schema.org Course) | **Частично** | Страница `/academics/[slug]` существует. Нет Schema.org Course разметки. | Средний | S |
| FR-020 | Многошаговая форма поступления (5 шагов, auto-save, CRM-интеграция) | **Частично** | Страница `/admission/apply` существует. Информационные страницы по всем этапам поступления (15 стр.). Нет многошаговой формы с auto-save, нет CRM. | Высокий | XL |
| FR-021 | Inline-валидация (email, phone, IIN) | **Отсутствует** | `react-hook-form` и `zod` установлены, но не используются. Форма обратной связи на `/contact` работает через API. | Средний | M |
| FR-022 | Загрузка документов (drag-drop, 10MB, preview) | **Отсутствует** | Нет компонента загрузки файлов. Нет S3. | Высокий | M |
| FR-023 | CRM-интеграция (Salesforce/HubSpot, webhook) | **Отсутствует** | Нет интеграции с внешними системами. | Высокий | L |
| FR-030 | Новостная лента с фильтрами по категории/тегу | **Готово** | ✅ Страница `/life/news` получает данные из публичного API. Фильтрация по 9 категориям. Пагинация. | — | — |
| FR-031 | Детальная страница новости (rich text из CMS, Schema.org Article) | **Частично** | ✅ Страница `/life/news/[id]` — серверный компонент, получает данные через `getNewsById`. Нет Schema.org Article. | Низкий | S |
| FR-032 | Календарь событий (месяц/неделя/список, подписка Google Calendar) | **Частично** | Страницы `/life/events` и `/life/events/calendar` существуют. Нет интеграции с Google Calendar. | Средний | M |
| FR-050 | Headless CMS (Strapi 5 / Payload CMS, REST + GraphQL) | **Частично** | ✅ JSON-based CMS реализована: админ-панель с CRUD, публичные API, файловое хранилище. Нужна миграция на полноценную headless CMS. | Средний | L |
| FR-051 | Роли CMS (Superadmin, Editor, Author, Faculty content manager) | **Частично** | Одна роль admin с HMAC-SHA256 аутентификацией. Нет гранулярных ролей. | Средний | M |
| FR-052 | Workflow публикации (Draft -> Review -> Published -> Archive) | **Частично** | Новости имеют статус `published`/`draft`. Нет полного workflow (Review, Archive). | Средний | M |
| FR-054 | Режим Preview с расшариваемыми ссылками | **Отсутствует** | Нет draft mode, нет preview API. | Низкий | M |
| FR-055 | Оптимизация медиа (WebP/AVIF авто-конвертация, lazy loading) | **Частично** | Next.js Image Optimization настроен. Нет S3-хранилища. | Средний | M |
| FR-060 | Полная поддержка 3 языков | **Готово** | ✅ 3 локали (kk/ru/en), 22 namespace-а, ~1000+ ключей на язык. Все 78 страниц локализованы через `next-intl`. | — | — |
| FR-061 | URL-структура /kz/ /ru/ /en/ | **Частично** | Middleware настроен с `/(kk|ru|en)/:path*`. Используется `/kk/` вместо `/kz/`. | Низкий | S |
| FR-063 | Переключатель языка с сохранением текущей страницы | **Готово** | ✅ `LanguageSwitcher` компонент работает корректно. | — | — |
| FR-064 | Теги hreflang | **Готово** | ✅ hreflang-теги реализованы на всех страницах. | — | — |

### 2.2 Функциональные требования — Фаза 2

| ID | Требование | Статус | Описание разрыва | Приоритет | Трудоемкость |
|----|-----------|--------|-------------------|-----------|-------------|
| FR-006 | Карусель отзывов | **Отсутствует** | Нет компонента карусели, нет данных отзывов. | Низкий | S |
| FR-024 | Email+SMS уведомления | **Отсутствует** | Нет SendGrid/SMS-провайдера. | Средний | L |
| FR-025 | Калькулятор стипендий | **Частично** | Страница `/admission/scholarships` существует с информацией о стипендиях. Нет интерактивного калькулятора. | Низкий | M |
| FR-026 | FAQ с AI-поиском | **Частично** | Страница `/admission/faq` существует с аккордеоном FAQ. Нет AI-поиска. | Низкий | M |
| FR-033 | Email-подписка (double opt-in) | **Отсутствует** | Нет формы подписки. | Низкий | M |
| FR-040 | 360-панорамы (10-15 точек) | **Отсутствует** | Нет панорамного просмотрщика. | Средний | XL |
| FR-041 | Интерактивные hotspots | **Отсутствует** | Связано с FR-040. | Средний | L |
| FR-042 | Карта кампуса (Google Maps) | **Отсутствует** | Страница `/contact` есть, но без Google Maps. | Средний | M |
| FR-053 | Версионирование контента | **Отсутствует** | JSON-хранилище не поддерживает версионирование. | Низкий | M |
| FR-070 | SSO (SAML 2.0 / OAuth 2.0 / OIDC) | **Отсутствует** | Нет аутентификации пользователей (только admin-auth). | Высокий | XL |
| FR-071 | Личный кабинет студента (расписание, оценки из LMS) | **Отсутствует** | Нет. | Высокий | XL |
| FR-072 | Настройки профиля пользователя | **Отсутствует** | Нет пользователей. | Средний | M |
| FR-073 | 2FA для CMS-администраторов | **Отсутствует** | Admin-auth без 2FA. | Средний | M |
| FR-080 | AI-чатбот (3 языка) | **Отсутствует** | Страницы AI-центра (9 шт.) существуют, но нет AI-чатбота. | Средний | XL |
| FR-081 | Эскалация чата на оператора | **Отсутствует** | Нет чата. | Низкий | L |

### 2.3 Нефункциональные требования

| ID | Требование | Статус | Описание разрыва | Приоритет | Трудоемкость |
|----|-----------|--------|-------------------|-----------|-------------|
| NFR-01 | LCP <= 2.5s | **Не проверено** | Нет Lighthouse CI, нет замеров. Hero-секция использует внешнее Unsplash-изображение через CSS `bg-[url()]` — вероятно LCP > 2.5s без CDN и оптимизации. | Высокий | M |
| NFR-02 | FID <= 100ms | **Не проверено** | Без нагрузочного тестирования невозможно подтвердить. Framer Motion может влиять на FID. | Средний | S |
| NFR-03 | CLS <= 0.1 | **Не проверено** | Нет замеров. Отсутствие `<Image>` компонента с заданными размерами может вызывать layout shift. | Средний | S |
| NFR-04 | TTFB <= 200ms | **Не проверено** | Railway-деплой без CDN. TTFB зависит от геолокации пользователя и серверной нагрузки. Без Redis-кеширования — вероятно > 200ms. | Высокий | L |
| NFR-05 | Lighthouse >= 90 | **Не проверено** | Нет Lighthouse CI. Предположительно 60-75 из-за отсутствия SEO-мета, accessibility, image optimization. | Высокий | L |
| NFR-07 | 10,000 concurrent users | **Не проверено** | Нет нагрузочного тестирования. Один контейнер на Railway без горизонтального масштабирования. Точно не выдержит 10K. | Критический | XL |
| NFR-09 | WCAG 2.2 AA 100% | **Частично** | `aria-label` и `aria-current` используются в Header. Но: нет систематической проверки, нет skip-links, нет focus-management, не проверены контрасты, нет axe-core тестов. | Высокий | L |
| NFR-13 | HTTPS/TLS 1.3 | **Частично** | Railway предоставляет HTTPS автоматически. Но: нет контроля версии TLS, нет HSTS-заголовков. | Средний | S |
| NFR-14 | CSP headers | **Отсутствует** | Нет Content-Security-Policy. Нет security headers. `poweredByHeader: false` — единственная мера безопасности. | Высокий | M |
| NFR-15 | WAF/DDoS защита | **Отсутствует** | Нет Cloudflare, нет WAF. Railway не предоставляет WAF из коробки. | Высокий | L |
| NFR-17 | Penetration testing | **Отсутствует** | Нет OWASP ZAP, нет security-аудита. | Высокий | L |
| NFR-19 | 99.5% uptime | **Частично** | Railway обеспечивает базовый uptime. Но: нет мониторинга, нет alerting, нет multi-region, нет Kubernetes. Healthcheck настроен в `railway.toml`. | Средний | L |
| NFR-25 | SEO Score >= 95 | **Частично** | hreflang-теги реализованы. Мета-теги и OG-теги на всех страницах. Но: нет sitemap.xml, нет Schema.org разметки, нет canonical URLs. | Средний | M |
| NFR-26 | Schema.org structured data | **Отсутствует** | Нет JSON-LD скриптов. Нет Schema.org Course, Article, Organization, BreadcrumbList. | Средний | M |

---

## 3. Анализ разрывов по компонентам (Component Gap Analysis)

### 3.1 Существующие компоненты (30 шт.)

**UI-компоненты (11):**

| Компонент | Путь | Соответствие ТЗ | Замечания |
|-----------|------|-----------------|-----------|
| Button | `src/components/ui/Button.tsx` | Годен | Базовый |
| Card | `src/components/ui/Card.tsx` | Годен | С поддержкой image, hover, glow |
| Badge | `src/components/ui/Badge.tsx` | Годен | Базовый |
| Input | `src/components/ui/Input.tsx` | Годен с доработкой | Нужна интеграция с react-hook-form |
| Select | `src/components/ui/Select.tsx` | Годен | Новый компонент |
| Tabs | `src/components/ui/Tabs.tsx` | Годен | Новый компонент |
| Accordion | `src/components/ui/Accordion.tsx` | Годен | Используется на FAQ и др. |
| Breadcrumb | `src/components/ui/Breadcrumb.tsx` | Годен | SEO-значимый |
| Pagination | `src/components/ui/Pagination.tsx` | Годен | Используется в новостях |
| Skeleton | `src/components/ui/Skeleton.tsx` | Годен | Для loading states |
| Toast | `src/components/ui/Toast.tsx` | Годен | Уведомления |

**Layout-компоненты (5):**

| Компонент | Путь | Соответствие ТЗ | Замечания |
|-----------|------|-----------------|-----------|
| Header | `src/components/layout/Header.tsx` | Годен | ✅ Мега-меню с 6 разделами |
| Footer | `src/components/layout/Footer.tsx` | Годен | ✅ Динамический, получает данные из admin settings |
| MobileMenu | `src/components/layout/MobileMenu.tsx` | Годен | Обновлён для мега-меню |
| ThemeToggle | `src/components/layout/ThemeToggle.tsx` | Годен | Работает |
| LanguageSwitcher | `src/components/layout/LanguageSwitcher.tsx` | Годен | ✅ Сохраняет текущую страницу |

**Card-компоненты (4):**

| Компонент | Путь | Соответствие ТЗ | Замечания |
|-----------|------|-----------------|-----------|
| NewsCard | `src/components/cards/NewsCard.tsx` | Годен | ✅ Для новостной ленты |
| EventCard | `src/components/cards/EventCard.tsx` | Годен | Для событий |
| ProgramCard | `src/components/cards/ProgramCard.tsx` | Годен | Для каталога программ |
| StatCard | `src/components/cards/StatCard.tsx` | Годен | Для статистики |

**Admin-компоненты (2):**

| Компонент | Путь | Соответствие ТЗ | Замечания |
|-----------|------|-----------------|-----------|
| AdminHeader | `src/components/admin/AdminHeader.tsx` | Годен | ✅ Заголовок админ-панели |
| AdminSidebar | `src/components/admin/AdminSidebar.tsx` | Годен | ✅ Навигация админ-панели |

**Прочие (8):**

| Компонент | Путь | Соответствие ТЗ | Замечания |
|-----------|------|-----------------|-----------|
| SearchOverlay | `src/components/search/SearchOverlay.tsx` | Годен | Глобальный поиск |
| ThemeProvider | `src/components/providers/ThemeProvider.tsx` | Годен | Работает |
| StudentCard | `src/components/talent/StudentCard.tsx` | Не в ТЗ | Для Talent Pool |
| ProgressBar | `src/components/talent/ProgressBar.tsx` | Частично | Для прогресса |
| SkillMap | `src/components/talent/SkillMap.tsx` | Не в ТЗ | Визуализация навыков |
| CircularProgress | `src/components/talent/CircularProgress.tsx` | Не в ТЗ | Для dashboard |
| RadarChart | `src/components/talent/RadarChart.tsx` | Не в ТЗ | Визуализация |
| StudentProfileView | `src/components/StudentProfileView.tsx` | Не в ТЗ | Профиль студента |

### 3.2 Компоненты, которые НЕОБХОДИМО создать

| Компонент | Для какого требования | Приоритет | Трудоемкость |
|-----------|----------------------|-----------|-------------|
| HeroSlider / VideoHero | FR-001 | Высокий | M |
| RoleQuickLinks | FR-002 | Средний | S |
| AnimatedCounter | FR-003 | Низкий | S |
| NewsCard / NewsFeed | FR-004, FR-030 | Высокий | M |
| EventCalendar | FR-005, FR-032 | Высокий | L |
| ProgramCatalog (с фильтрами) | FR-010, FR-011, FR-012 | Высокий | L |
| ProgramDetail (аккордеон) | FR-013 | Высокий | M |
| MultiStepForm | FR-020 | Критический | XL |
| FormStepIndicator | FR-020 | Высокий | S |
| FileUpload (drag-drop) | FR-022 | Высокий | M |
| InlineValidator | FR-021 | Высокий | M |
| RichTextRenderer | FR-031 | Высокий | M |
| TestimonialCarousel | FR-006 | Низкий | S |
| ScholarshipCalculator | FR-025 | Низкий | M |
| FAQAccordion + AISearch | FR-026 | Низкий | L |
| EmailSubscribeForm | FR-033 | Низкий | S |
| PanoramaViewer | FR-040 | Средний | XL |
| CampusMap | FR-042 | Средний | M |
| UserDashboard | FR-071 | Высокий | XL |
| UserProfileSettings | FR-072 | Средний | M |
| ChatBot | FR-080 | Средний | XL |
| ChatWidget | FR-081 | Средний | L |
| SchemaJsonLd | NFR-26 | Высокий | M |
| Breadcrumbs | NFR-25/SEO | Средний | S |
| SkipLink | NFR-09/A11y | Средний | S |
| SearchModal (глобальный) | FR-011 | Средний | M |

**Итого:** 30 компонентов реализовано (из них ~22 годны без доработки), нужно создать ещё ~15-20 компонентов для полного соответствия ТЗ.

**Уже реализованные из списка «необходимых»:** NewsCard/NewsFeed (✅), Breadcrumbs (✅), SearchModal/Overlay (✅), ProgramCard (✅), EventCard (✅), StatCard (✅), FAQAccordion (✅ Accordion.tsx), Tabs (✅), Select (✅), Pagination (✅), Skeleton (✅), Toast (✅).

---

## 4. Анализ разрывов инфраструктуры (Infrastructure Gap Analysis)

### 4.1 Что существует

| Элемент | Текущее состояние | Замечания |
|---------|------------------|-----------|
| Docker | Dockerfile (Node 22 Alpine, multi-stage build) | Хорошо написан, standalone output, non-root |
| Railway | railway.toml с healthcheck | Базовый деплой, restart on_failure |
| CI/CD | GitHub Actions (`.github/workflows/ci.yml`) | Lint → TypeScript → Test → Build |
| pnpm | pnpm-lock.yaml, pnpm-workspace.yaml | Монорепо готово, pnpm 10 |
| Next.js config | `next.config.ts` с standalone, compress, remotePatterns | Базовая настройка |
| Healthcheck | `GET /api/health` | Status, timestamp, uptime |
| Admin API | **17 эндпоинтов** | Auth, session, news CRUD, settings, translations, menu, university, homepage, contact, upload, AI (4), social (2) |
| Public API | **6 эндпоинтов** | News, settings, menu, homepage, university, contact |
| General API | **2 эндпоинта** | Health check, contact form |
| JSON storage | **6 файлов** (news, settings, menu, homepage, university, contact) | Файловое хранилище данных |
| Admin auth | HMAC-SHA256 + httpOnly cookies | Аутентификация администратора |
| AI Integration | Google Gemini 2.5 (Flash/Pro/Lite) | Авто-перевод, анализ, валидация |
| Social Media | Telegram Bot API + Instagram Graph API v21.0 | Авто-публикация новостей |
| Unit Tests | Vitest 4.0.18 + React Testing Library | 7 тестов (6 компонентов + 1 утилита) |
| E2E Framework | Playwright 1.58.2 | Настроен, тесты не написаны |

### 4.2 Что НЕОБХОДИМО, но ОТСУТСТВУЕТ

| Элемент | Требование ТЗ | Текущее состояние | Приоритет | Трудоемкость |
|---------|--------------|------------------|-----------|-------------|
| **PostgreSQL 16** | База данных для CMS, пользователей, форм | Нет. Все данные в `.ts` файлах | Критический | L |
| **Redis 7** | Кеширование, сессии, rate limiting | Нет | Высокий | M |
| **Meilisearch / Algolia** | Полнотекстовый поиск по сайту | Нет | Высокий | L |
| **S3-совместимое хранилище** | Медиа-файлы, загруженные документы (FR-022) | Нет. Изображения — внешние URL Unsplash | Высокий | M |
| **CDN (Cloudflare)** | Кеширование статики, WAF, DDoS-защита | Нет. Railway без CDN | Высокий | M |
| **CI/CD (GitHub Actions)** | Автоматический build, test, deploy | ✅ Частично. Lint + TypeScript + Test + Build настроены. Нет auto-deploy, staging, rollback | Средний | M |
| **Мониторинг (Sentry)** | Error tracking, performance monitoring | Нет. Нет даже error boundary в React | Высокий | M |
| **Мониторинг (Grafana)** | Dashboards, метрики, alerting | Нет | Средний | L |
| **Kubernetes** | Оркестрация, auto-scaling, rolling updates | Нет. Один контейнер на Railway | Высокий | XL |
| **Docker Compose** | Локальная разработка с PostgreSQL, Redis | Нет. Только Dockerfile для прода | Средний | S |
| **Nginx / Reverse Proxy** | Load balancing, SSL termination | Нет | Средний | M |
| **Backup система** | Бэкапы БД, медиа | Нет | Высокий | M |

### 4.3 Разрыв в миграции от текущей к целевой архитектуре

```
ТЕКУЩЕЕ СОСТОЯНИЕ:                    ЦЕЛЕВОЕ СОСТОЯНИЕ (ТЗ):

[Next.js App] ─── hardcoded data      [Next.js App]
      │                                     │
[Railway] ── single container          [Cloudflare CDN]
                                            │
                                       [Kubernetes Cluster]
                                       ┌────┴────┐
                                       │         │
                                  [Next.js]  [Strapi/Payload CMS]
                                       │         │
                                  [Redis]    [PostgreSQL]
                                       │         │
                                  [Meilisearch] [S3 Storage]
                                       │
                                  [Sentry + Grafana]
```

**Вывод:** Архитектурный разрыв колоссальный. Необходим полный рефакторинг инфраструктуры.

---

## 5. Анализ разрывов интеграций (Integration Gap Analysis)

**Текущее состояние: 1 частичная интеграция (JSON-based CMS) из 10+ требуемых.**

| Интеграция | Требование ТЗ | Статус | Приоритет (MVP) | Трудоемкость |
|-----------|--------------|--------|-----------------|-------------|
| **Headless CMS** (Strapi 5 / Payload CMS) | FR-050 | **Частично** (JSON-based CMS) | Средний | L |
| **CRM** (Salesforce / HubSpot) | FR-023 | Отсутствует | Высокий | L |
| **Google Calendar API** | FR-005, FR-032 | Отсутствует | Высокий | L |
| **Email-сервис** (SendGrid) | FR-024, FR-033 | Отсутствует | Средний | M |
| **Google Maps** | FR-042 | Отсутствует | Средний | M |
| **Платежные системы** (Kaspi Pay) | Фаза 2 | Отсутствует | Низкий | XL |
| **University SSO / LDAP** | FR-070 | Отсутствует | Высокий (Фаза 2) | XL |
| **LMS** (Moodle, LTI 1.3) | FR-071 | Отсутствует | Высокий (Фаза 2) | XL |
| **Scopus / Web of Science** | Фаза 2 | Отсутствует | Низкий | L |
| **Библиотечная система** | Фаза 2 | Отсутствует | Низкий | L |
| **Intercom / Zendesk** | FR-081 | Отсутствует | Низкий | M |

### Блокирующие зависимости

```
CMS (FR-050)  ─ блокирует ─→  FR-001, FR-004, FR-030, FR-031, FR-051, FR-052, FR-054
PostgreSQL    ─ блокирует ─→  FR-050, FR-020, FR-070, FR-071
SSO (FR-070)  ─ блокирует ─→  FR-071, FR-072, FR-073
CRM (FR-023)  ─ блокирует ─→  FR-020 (полностью)
```

**Вывод:** CMS и база данных — фундаментальные блокеры. Без них 60%+ требований ТЗ невозможно реализовать в принципе.

---

## 6. Анализ разрывов тестирования (Testing Gap Analysis)

### Текущее состояние: НАЧАЛЬНОЕ

- **7 unit-тестов** (6 компонентов: Button, Card, Input, Accordion, Skeleton, Tabs + 1 утилита: utils.ts)
- **Vitest 4.0.18** настроен с coverage (V8)
- **Playwright 1.58.2** установлен, каталог `e2e/` создан, тесты не написаны
- **React Testing Library 16.3.2** для тестирования компонентов
- **GitHub Actions CI** запускает `pnpm test:ci` на каждый push/PR
- Скрипты: `test`, `test:ci`, `test:watch`
- Конфигурация: `vitest.config.ts`

### Требования ТЗ vs Реальность

| Тип тестирования | Требование ТЗ | Текущее состояние | Трудоемкость |
|-----------------|--------------|------------------|-------------|
| **Unit-тесты** | Vitest, >= 80% coverage | ✅ Настроен. 7 тестов, покрытие минимально. CI интегрирован. | L (написание) |
| **E2E-тесты** | Playwright | ✅ Настроен. 0 тестов написано. | L (написание) |
| **Visual regression** | Chromatic | Нет Storybook, нет Chromatic. | L (Storybook + Chromatic) |
| **Performance** | Lighthouse CI | Нет Lighthouse CI. | M (настройка CI) |
| **Accessibility** | axe-core | Нет axe-core. | M (настройка + написание) |
| **Security** | OWASP ZAP | Нет. | L (сканирование + исправления) |
| **Нагрузочное** | 10K concurrent | Нет k6/Artillery. | L (сценарии + оптимизация) |

### Оценка трудоемкости достижения 80% unit-покрытия

При текущих ~40 файлах (`.ts` + `.tsx`) и оценке ~2-4 тестовых файла на каждый:

- **Компоненты (16):** ~48-64 тест-кейса = 1-2 недели
- **Утилиты/lib (6 файлов):** ~30-50 тест-кейсов = 3-5 дней
- **API-эндпоинты (1+будущие):** ~20-40 тест-кейсов = 1 неделя
- **Хуки (1+будущие):** ~10-20 тест-кейсов = 2-3 дня
- **E2E сценарии:** ~15-25 сценариев = 2 недели

**Итого на полное тестовое покрытие: ~6-8 недель** (с учетом кода, который будет написан для MVP).

---

## 7. Оценка рисков (Risk Assessment)

### Критические риски (блокируют запуск проекта)

| # | Риск | Вероятность | Влияние | Описание | Митигация |
|---|------|------------|---------|----------|-----------|
| R1 | **Отсутствие CMS блокирует весь контент** | 100% | Критическое | Без CMS редакторы не могут публиковать новости, обновлять программы, управлять медиа. Весь контент захардкожен. | Начать с развертывания Strapi 5 / Payload CMS в первую очередь. |
| R2 | **Отсутствие БД блокирует формы и авторизацию** | 100% | Критическое | Без PostgreSQL невозможна форма поступления (FR-020), SSO (FR-070), личные кабинеты (FR-071). | Развернуть PostgreSQL 16 параллельно с CMS. |
| R3 | **Минимальное тестовое покрытие** | Высокая | Высокое | 7 unit-тестов, Vitest + Playwright настроены, CI запускает тесты. Но покрытие минимально — регрессии всё ещё возможны. | Написать unit-тесты для API-эндпоинтов и admin-утилит. Написать E2E для критических сценариев. |
| R4 | **Нет горизонтального масштабирования** | Высокая | Критическое | Один контейнер на Railway не выдержит 10K concurrent пользователей (NFR-07). Приемная кампания = пиковая нагрузка. | Мигрировать на Kubernetes или как минимум настроить auto-scaling. |

### Высокие риски

| # | Риск | Вероятность | Влияние | Описание | Митигация |
|---|------|------------|---------|----------|-----------|
| R5 | **Отсутствие security headers** | 100% | Высокое | Нет CSP, HSTS, X-Frame-Options. Уязвимость для XSS, clickjacking. | Добавить middleware для security headers. |
| R6 | **Частично захардкоженные данные** | Средняя | Среднее | Основные данные (новости, настройки, меню, университет, контакты, главная) вынесены в JSON-CMS. Но программы, статистика частично в `.ts` файлах. | Продолжить миграцию данных в CMS. |
| R7 | **SEO частично реализован** | Средняя | Среднее | hreflang, мета-теги, OG-теги, robots.txt, sitemap.xml реализованы. Нет Schema.org JSON-LD. | Добавить JSON-LD разметку (Organization, Course, Article). |
| R8 | **Изображения с внешних URL** | Высокая | Среднее | Все изображения — с Unsplash. Если Unsplash станет недоступен, сайт потеряет все фото. Нет контроля над CORS, CDN-кешированием. | Загрузить изображения в S3, настроить CDN. |

### Средние риски

| # | Риск | Вероятность | Влияние | Описание | Митигация |
|---|------|------------|---------|----------|-----------|
| R9 | **Техдолг от прототипа** | Высокая | Среднее | Текущий код написан как прототип. Много inline-стилей, захардкоженных строк, отсутствие разделения concerns. Рефакторинг потребуется при масштабировании. | Провести code review, выделить время на рефакторинг. |
| R10 | **Локаль kk vs kz** | Средняя | Среднее | ТЗ требует `/kz/` в URL, код использует `/kk/` (ISO 639-1 для казахского). Потенциальный конфликт со стандартами vs ожиданиями пользователей. | Обсудить с заказчиком и зафиксировать решение. |
| R11 | **Зависимость от Railway** | Средняя | Среднее | ТЗ требует Kubernetes, но текущий деплой на Railway. Миграция потребует значительных усилий. | Планировать миграцию заранее, писать код cloud-agnostic. |

---

## 8. Рекомендуемый порядок действий (Recommended Priority Actions)

### Фаза 0: Фундамент (недели 1-4)

Без этих шагов невозможно начать работу по ТЗ.

| # | Действие | Трудоемкость | Обоснование |
|---|---------|-------------|-------------|
| 1 | **Развернуть PostgreSQL 16** (managed instance или Docker) | M | Блокирует CMS, формы, аутентификацию |
| 2 | **Развернуть и настроить CMS** (Strapi 5 или Payload CMS) | XL | Блокирует FR-001, FR-004, FR-030, FR-031, FR-050-055. Критический путь. |
| 3 | **Настроить CI/CD** (GitHub Actions: lint, build, test) | M | Без CI/CD нет контроля качества. Настроить до начала активной разработки. |
| 4 | **Настроить тестовый фреймворк** (Vitest + Playwright + axe-core) | M | R3 — 0% покрытия неприемлемо. Написать первые тесты для существующих компонентов. |
| 5 | **Развернуть Redis 7** | S | Кеширование CMS-ответов, сессии, rate limiting |
| 6 | **Настроить S3-хранилище** (MinIO / AWS S3 / Cloudflare R2) | M | Убрать зависимость от Unsplash, подготовить для FR-022 |

### Фаза 1: MVP-функционал (недели 5-14)

| # | Действие | Трудоемкость | Обоснование |
|---|---------|-------------|-------------|
| 7 | **Создать CMS-контент-модели** (programs, news, events, pages) | L | Перенести захардкоженные данные из `.ts` в CMS |
| 8 | **Реализовать API-слой** (Next.js API routes + CMS-клиент) | L | Связать фронтенд с CMS |
| 9 | **Рефакторинг главной страницы** (FR-001, FR-002, FR-003, FR-004, FR-005) | L | Hero с видео/слайдером, ролевые ссылки, анимированные счетчики, блок новостей, блок событий |
| 10 | **Каталог программ** (FR-010, FR-011, FR-012, FR-013) | L | Фасетная фильтрация, сортировка, URL-персистентность, детальные страницы |
| 11 | **Многошаговая форма поступления** (FR-020, FR-021, FR-022) | XL | 5 шагов, валидация, загрузка документов, auto-save. Самый сложный UI-компонент. |
| 12 | **Новостная лента** (FR-030, FR-031) | L | Лента с фильтрами, детальные страницы, rich text из CMS |
| 13 | **SEO-оптимизация** (NFR-25, NFR-26, FR-064) | M | Schema.org, hreflang, sitemap.xml, robots.txt, OpenGraph |
| 14 | **Security headers** (NFR-13, NFR-14) | M | CSP, HSTS, X-Frame-Options, security middleware |
| 15 | **CRM-интеграция** (FR-023) | L | Webhook для формы поступления -> Salesforce/HubSpot |
| 16 | **Настроить CDN** (Cloudflare) | M | NFR-01, NFR-04, NFR-15 |
| 17 | **Полная локализация** (FR-060, FR-061) | M | Ревизия всех захардкоженных строк, решение kk vs kz |
| 18 | **Unit + E2E тесты для MVP** | L | Покрыть критические flow (поступление, каталог, навигация) |

### Фаза 2: Расширение (недели 15-26)

| # | Действие | Трудоемкость | Обоснование |
|---|---------|-------------|-------------|
| 19 | **SSO / Аутентификация** (FR-070, FR-073) | XL | SAML 2.0 + OAuth 2.0, 2FA для админов |
| 20 | **Личный кабинет студента** (FR-071, FR-072) | XL | Dashboard, интеграция с LMS |
| 21 | **LMS-интеграция** (Moodle, LTI 1.3) | XL | Расписание, оценки |
| 22 | **Календарь событий** (FR-032) | L | Полный календарь с Google Calendar |
| 23 | **AI-чатбот** (FR-080, FR-081) | XL | 3 языка, эскалация |
| 24 | **Виртуальный тур** (FR-040, FR-041) | XL | 360-панорамы, hotspots |
| 25 | **Мониторинг** (Sentry + Grafana) | L | Error tracking, performance dashboards |
| 26 | **Миграция на Kubernetes** | XL | Горизонтальное масштабирование, 10K users |
| 27 | **Нагрузочное тестирование** (NFR-07) | L | k6/Artillery, оптимизация |
| 28 | **Penetration testing** (NFR-17) | L | OWASP ZAP, исправление уязвимостей |
| 29 | **Visual regression** (Storybook + Chromatic) | L | Предотвращение визуальных регрессий |
| 30 | **Дополнительные интеграции** (Kaspi Pay, Scopus, библиотека) | XL | По мере готовности |

---

## Итоговая оценка

| Метрика | Значение |
|---------|----------|
| **Общая готовность проекта к ТЗ** | **~55-60%** |
| **Готовность фронтенда** | **~90%** (82 публичных страницы, все разделы покрыты) |
| **Готовность CMS** | **~50%** (JSON-based CMS, 11 admin-стр., 25 API, AI-перевод, авто-публикация) |
| **Готовность бэкенда** | **~45%** (25 API-эндпоинтов, admin auth, AI, social) |
| **Готовность инфраструктуры** | **~15%** (Docker + Railway + CI/CD) |
| **Готовность интеграций** | **~15%** (Google Gemini AI, Telegram, Instagram) |
| **Готовность тестирования** | **~10%** (7 unit-тестов, Vitest + Playwright настроены, CI) |
| **Готовность безопасности** | **~20%** (HMAC-SHA256, httpOnly cookies, non-root Docker, file validation) |
| **Готовность i18n / SEO** | **~80%** (полная i18n ~3 350+ ключей, hreflang, мета-теги, robots.txt, sitemap.xml) |
| **Компонентов реализовано** | **30** из ~50 необходимых |
| **Оценка до MVP-запуска** | **6-10 недель** (основные пробелы: тесты, CMS-миграция, безопасность) |
| **Оценка полного ТЗ** | **18-24 недели** при команде 3-4 разработчика |
| **Количество новых компонентов** | ~15-20 |
| **Количество новых API-эндпоинтов** | ~5-10 |
| **Количество новых интеграций** | 7+ (CRM, LMS, SSO, платежи, Google Calendar, Scopus, библиотека) |

### Главный вывод

Проект ZhezU значительно продвинулся от **визуального прототипа** к **зрелой функциональной платформе с CMS и AI-интеграциями**. Реализовано 93 страницы (82 публичных + 11 admin), 30 компонентов, 25 API-эндпоинтов, полная трёхъязычная локализация (~3 350+ ключей), админ-панель с управлением контентом, AI-авто-перевод (Google Gemini), авто-публикация в Telegram и Instagram, CI/CD через GitHub Actions. Все публичные страницы динамически получают данные из админ-панели.

**Основные оставшиеся пробелы:**
1. Миграция с JSON-хранилища на полноценную Headless CMS (PostgreSQL + Strapi/Payload)
2. Расширение тестового покрытия (текущее: 7 unit-тестов → цель: ≥80%)
3. Аутентификация пользователей (есть только admin)
4. Security headers (CSP, HSTS, rate limiting)
5. Внешние интеграции (CRM, LMS, SSO, платежи)
6. Мониторинг (Sentry, Grafana)
7. Schema.org JSON-LD разметка

**Критический путь:** PostgreSQL → Headless CMS → Миграция данных → Security headers → Тесты → CDN → Запуск MVP.
